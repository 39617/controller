<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>Controller: E:/ISEL Projects/teste/coap_client.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Controller
   </div>
   <div id="projectbrief">IOT Project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">E:/ISEL Projects/teste/coap_client.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="coap__client_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="coap__client_8h.html">coap_client.h</a>&quot;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="coap__node_8h.html">coap_node.h</a>&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="httpd_8h.html">httpd.h</a>&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="er-http_8h.html">er-http.h</a>&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="error__codes_8h.html">error_codes.h</a>&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;er-coap-constants.h&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;er-coap-engine.h&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="group__Debug.html#gad72dbcf6d0153db1b8d8a58001feed83">   21</a></span>&#160;<span class="preprocessor">#define DEBUG 1</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#if DEBUG</span></div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="group__Debug.html#ga1f464e950a4fa11e8821b5c725921a15">   23</a></span>&#160;<span class="preprocessor">#define PRINTF(...) printf(__VA_ARGS__)</span></div><div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="group__Debug.html#gaff3d1794e2cc9c47274479863b851d2d">   24</a></span>&#160;<span class="preprocessor">#define PRINT6ADDR(addr) PRINTF(&quot;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]&quot;, ((uint8_t *)addr)[0], ((uint8_t *)addr)[1], ((uint8_t *)addr)[2], ((uint8_t *)addr)[3], ((uint8_t *)addr)[4], ((uint8_t *)addr)[5], ((uint8_t *)addr)[6], ((uint8_t *)addr)[7], ((uint8_t *)addr)[8], ((uint8_t *)addr)[9], ((uint8_t *)addr)[10], ((uint8_t *)addr)[11], ((uint8_t *)addr)[12], ((uint8_t *)addr)[13], ((uint8_t *)addr)[14], ((uint8_t *)addr)[15])</span></div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="group__Debug.html#gac5c3cb768f9a03400103971d1f2c84d9">   25</a></span>&#160;<span class="preprocessor">#define PRINTLLADDR(lladdr) PRINTF(&quot;[%02x:%02x:%02x:%02x:%02x:%02x]&quot;, (lladdr)-&gt;addr[0], (lladdr)-&gt;addr[1], (lladdr)-&gt;addr[2], (lladdr)-&gt;addr[3], (lladdr)-&gt;addr[4], (lladdr)-&gt;addr[5])</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#define PRINTF(...)</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#define PRINT6ADDR(addr)</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#define PRINTLLADDR(addr)</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<a class="code" href="coap__client_8c.html#a4c8a1aeb0a1801312b52ea2cdfb6cf9a">PROCESS</a>(coap_client_process, <span class="stringliteral">&quot;CoAP Client&quot;</span>); </div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">static</span> <a class="code" href="struct__coap__client__request.html">coap_client_request_t</a> original_request[1];</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="group__CoAP__Client.html#ga89becbec245835d678855d3571224532">   38</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__CoAP__Client.html#ga89becbec245835d678855d3571224532">coap_client_current_req_number</a>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="group__CoAP__Client.html#gaa6812ba14a17a404e0649f5bbce3242b">   40</a></span>&#160;process_event_t <a class="code" href="group__CoAP__Client.html#gaa6812ba14a17a404e0649f5bbce3242b">coap_client_event_new_request</a>; </div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">static</span> coap_packet_t request_packet[1];</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> reset_original_request(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;{</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    memset(original_request, 0x0, <span class="keyword">sizeof</span>(<a class="code" href="struct__coap__client__request.html">coap_client_request_t</a>));</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> parse_uri_query(<span class="keywordtype">char</span> *query, <span class="keywordtype">int</span> query_len)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;{</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; query_len; i++)</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">if</span> (query[i] == <a class="code" href="group__HTTP.html#gac71a488f29b32c1d43eb6cf6eab9544a">ISO_semi_colon</a>)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            *(&amp;query[i]) = <a class="code" href="group__HTTP.html#ga5277054d2661bd306a1f433fad5f52c6">ISO_amp</a>;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        }</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> parse_request(<a class="code" href="struct__coap__node__entry.html">coap_node_entry_t</a> *dst_node)</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;{</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    reset_original_request();</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="structhttpd__state.html">httpd_state</a> * http_state = (<a class="code" href="structhttpd__state.html">httpd_state</a> *) dst_node-&gt;<a class="code" href="struct__coap__node__entry.html#ac178f0afc26790704d17ca2ea92fdcad">node_data</a>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// Set the corresponding Node object</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    original_request-&gt;<a class="code" href="struct__coap__client__request.html#ab7e9d17ee3d65a11fadd75d061ce1b9a">owner</a> = (<span class="keywordtype">void</span> *) dst_node;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// store our connection</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    original_request-&gt;<a class="code" href="struct__coap__client__request.html#a9fd8c98c9dea2d5880f4819d25ebd5f3">http_conn</a> = uip_conn;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// Request Method</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    original_request-&gt;<a class="code" href="struct__coap__client__request.html#a0bf599ccdebfc7a8afadea03b9ff361c">method</a> = http_state-&gt;<a class="code" href="structhttpd__state.html#ac07fcecad21574af592e6ec01836cf45">request_type</a>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// URI</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    memcpy(original_request-&gt;<a class="code" href="struct__coap__client__request.html#a72c43dde31cefd70083b9bc0a1ed7c07">uri</a>, http_state-&gt;<a class="code" href="structhttpd__state.html#a50800bbad71d7f97217d783bde34249c">coap_req</a>.<a class="code" href="structcoap__request__params__t.html#a0b5de1f23728fbc139c7a5ee997bda32">action</a>,</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;           MIN(http_state-&gt;<a class="code" href="structhttpd__state.html#a50800bbad71d7f97217d783bde34249c">coap_req</a>.<a class="code" href="structcoap__request__params__t.html#ac262fa94e91da6023516bf068fcbd5c7">action_len</a>, <a class="code" href="group__HTTP.html#ga0098566b2a9196c26cca3f296ee491a6">POST_PARAMS_VAL_MAX_LEN</a> - 1));</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">// guarantee the null terminator</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    original_request-&gt;<a class="code" href="struct__coap__client__request.html#a72c43dde31cefd70083b9bc0a1ed7c07">uri</a>[MIN(http_state-&gt;<a class="code" href="structhttpd__state.html#a50800bbad71d7f97217d783bde34249c">coap_req</a>.<a class="code" href="structcoap__request__params__t.html#ac262fa94e91da6023516bf068fcbd5c7">action_len</a>,</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                              <a class="code" href="group__HTTP.html#ga0098566b2a9196c26cca3f296ee491a6">POST_PARAMS_VAL_MAX_LEN</a> - 1)] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// Parameters - are optional</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">if</span> (http_state-&gt;<a class="code" href="structhttpd__state.html#a50800bbad71d7f97217d783bde34249c">coap_req</a>.<a class="code" href="structcoap__request__params__t.html#ace41c1cce5e601f022ec15f86719ef4a">params_len</a> &gt; 0)</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        memcpy(original_request-&gt;<a class="code" href="struct__coap__client__request.html#a3af446f5833143823da2e317e5e1ad4e">params</a>,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;               http_state-&gt;<a class="code" href="structhttpd__state.html#a50800bbad71d7f97217d783bde34249c">coap_req</a>.<a class="code" href="structcoap__request__params__t.html#a3ff7e4795a66b68be9e1dcc6e404a643">params</a>,</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;               MIN(http_state-&gt;<a class="code" href="structhttpd__state.html#a50800bbad71d7f97217d783bde34249c">coap_req</a>.<a class="code" href="structcoap__request__params__t.html#ace41c1cce5e601f022ec15f86719ef4a">params_len</a>,</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                   <a class="code" href="group__HTTP.html#ga0098566b2a9196c26cca3f296ee491a6">POST_PARAMS_VAL_MAX_LEN</a> - 1));</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="comment">// guarantee the null terminator</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        original_request-&gt;<a class="code" href="struct__coap__client__request.html#a3af446f5833143823da2e317e5e1ad4e">params</a>[MIN(http_state-&gt;<a class="code" href="structhttpd__state.html#a50800bbad71d7f97217d783bde34249c">coap_req</a>.<a class="code" href="structcoap__request__params__t.html#ace41c1cce5e601f022ec15f86719ef4a">params_len</a>,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                                     <a class="code" href="group__HTTP.html#ga0098566b2a9196c26cca3f296ee491a6">POST_PARAMS_VAL_MAX_LEN</a> - 1)] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        parse_uri_query(</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                original_request-&gt;<a class="code" href="struct__coap__client__request.html#a3af446f5833143823da2e317e5e1ad4e">params</a>,</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                MIN(http_state-&gt;<a class="code" href="structhttpd__state.html#a50800bbad71d7f97217d783bde34249c">coap_req</a>.<a class="code" href="structcoap__request__params__t.html#ace41c1cce5e601f022ec15f86719ef4a">params_len</a>,</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    <a class="code" href="group__HTTP.html#ga0098566b2a9196c26cca3f296ee491a6">POST_PARAMS_VAL_MAX_LEN</a> - 1));</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// Request Type</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span> (http_state-&gt;<a class="code" href="structhttpd__state.html#ac07fcecad21574af592e6ec01836cf45">request_type</a> == <a class="code" href="group__HTTP.html#ga008073805743aea3964e9a2502109aa1">REQUEST_TYPE_POST</a>)</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        memcpy(original_request-&gt;<a class="code" href="struct__coap__client__request.html#a7c9bdf048a6f3f99f120227bb6542eae">buffer</a>, http_state-&gt;<a class="code" href="structhttpd__state.html#a3d38632fd170046da9c12d8656332a15">buffer</a>,</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;               http_state-&gt;<a class="code" href="structhttpd__state.html#a93ff231e84af820b17c22f5bcede2150">content_length</a>);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        original_request-&gt;<a class="code" href="struct__coap__client__request.html#a11d86892e4742eaf25ae61e6948b702f">blen</a> = http_state-&gt;<a class="code" href="structhttpd__state.html#a93ff231e84af820b17c22f5bcede2150">content_length</a>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;}</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> prepare_request(<a class="code" href="struct__coap__node__entry.html">coap_node_entry_t</a> *dst_node)</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;{</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    parse_request(dst_node);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">/* prepare request, TID is set by COAP_BLOCKING_REQUEST() */</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    coap_init_message(request_packet, COAP_TYPE_CON, original_request-&gt;<a class="code" href="struct__coap__client__request.html#a0bf599ccdebfc7a8afadea03b9ff361c">method</a>,</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                      0);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    coap_set_header_uri_path(request_packet, original_request-&gt;<a class="code" href="struct__coap__client__request.html#a72c43dde31cefd70083b9bc0a1ed7c07">uri</a>);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    coap_set_header_uri_query(request_packet, original_request-&gt;<a class="code" href="struct__coap__client__request.html#a3af446f5833143823da2e317e5e1ad4e">params</a>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> (original_request-&gt;<a class="code" href="struct__coap__client__request.html#a0bf599ccdebfc7a8afadea03b9ff361c">method</a> &amp; METHOD_POST)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        coap_set_payload(request_packet, (uint8_t *) original_request-&gt;<a class="code" href="struct__coap__client__request.html#a7c9bdf048a6f3f99f120227bb6542eae">buffer</a>,</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                         original_request-&gt;<a class="code" href="struct__coap__client__request.html#a11d86892e4742eaf25ae61e6948b702f">blen</a>);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;}</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="coap__client_8c.html#a229ddaf533d2f729a841a99d80834546">  162</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="coap__client_8c.html#a229ddaf533d2f729a841a99d80834546">client_chunk_handler</a>(<span class="keywordtype">void</span> *response)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;{</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    coap_packet_t * res = (coap_packet_t *) response;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keyword">const</span> uint8_t *chunk;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// select CoAP rest</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    rest_select_if(COAP_IF);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// Status code</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    original_request-&gt;<a class="code" href="struct__coap__client__request.html#ad0a7a8b7c5802f324f0906a3fc8ab878">resp_status</a> = res-&gt;code;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    original_request-&gt;<a class="code" href="struct__coap__client__request.html#a6f31e733fa039df89fe3139b4683af1e">content_type</a> = res-&gt;content_format;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">int</span> len = REST.get_request_payload(response, &amp;chunk);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    memcpy(original_request-&gt;<a class="code" href="struct__coap__client__request.html#a7c9bdf048a6f3f99f120227bb6542eae">buffer</a>, chunk, len);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">//res-&gt;user_data-&gt;blen = len;</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    original_request-&gt;<a class="code" href="struct__coap__client__request.html#a11d86892e4742eaf25ae61e6948b702f">blen</a> = len;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;}</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="coap__client_8c.html#a0bfa1dc3bdf242a79626b4f855e17615">  190</a></span>&#160;<a class="code" href="coap__client_8c.html#a0bfa1dc3bdf242a79626b4f855e17615">PROCESS_THREAD</a>(coap_client_process, ev, data)</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;{</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    PROCESS_BEGIN();</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <a class="code" href="group__CoAP__Client.html#ga89becbec245835d678855d3571224532">coap_client_current_req_number</a> = 0;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="comment">// owner of received requests</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keyword">static</span> <a class="code" href="struct__coap__node__entry.html">coap_node_entry_t</a> *owner;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="comment">// Get an Event Id</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <a class="code" href="group__CoAP__Client.html#gaa6812ba14a17a404e0649f5bbce3242b">coap_client_event_new_request</a> = process_alloc_event();</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        PROCESS_PAUSE();</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">while</span> (1)</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            PROCESS_WAIT_UNTIL((ev == <a class="code" href="group__CoAP__Client.html#gaa6812ba14a17a404e0649f5bbce3242b">coap_client_event_new_request</a>));</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <a class="code" href="group__Debug.html#ga1f464e950a4fa11e8821b5c725921a15">PRINTF</a>(<span class="stringliteral">&quot;\n**TODO COAP CLIENT!!!!!&quot;</span>);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            owner = (<a class="code" href="struct__coap__node__entry.html">coap_node_entry_t</a> *) data;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            prepare_request((<a class="code" href="struct__coap__node__entry.html">coap_node_entry_t</a> *) data);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            ((<a class="code" href="structhttpd__state.html">httpd_state</a> *) owner-&gt;<a class="code" href="struct__coap__node__entry.html#ac178f0afc26790704d17ca2ea92fdcad">node_data</a>)-&gt;response.immediate_response = 0;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <a class="code" href="group__CoAP__Client.html#ga89becbec245835d678855d3571224532">coap_client_current_req_number</a>++;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <span class="comment">// Make the CoAP request!</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            COAP_BLOCKING_REQUEST(</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                    (uip_ip6addr_t * )((<a class="code" href="struct__coap__node__entry.html">coap_node_entry_t</a> * )data)-&gt;ip,</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                    UIP_HTONS(COAP_DEFAULT_PORT), request_packet,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                    <a class="code" href="coap__client_8c.html#a229ddaf533d2f729a841a99d80834546">client_chunk_handler</a>);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="comment">// Send to httpd</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            process_post_synch(&amp;httpd_process, <a class="code" href="group__cc26xx-web-demo.html#gac045fe0b35ad45736402b693b70e62bd">coap_client_event_new_response</a>,</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                               original_request);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="comment">// free CoAP client</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <a class="code" href="group__CoAP__Client.html#ga89becbec245835d678855d3571224532">coap_client_current_req_number</a>--;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="comment">// update the owner requests number</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            owner-&gt;<a class="code" href="struct__coap__node__entry.html#aa20aa666bcdd70663a273b214dcf691a">requests</a>--;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    PROCESS_END();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div><div class="ttc" id="structcoap__request__params__t_html_ace41c1cce5e601f022ec15f86719ef4a"><div class="ttname"><a href="structcoap__request__params__t.html#ace41c1cce5e601f022ec15f86719ef4a">coap_request_params_t::params_len</a></div><div class="ttdeci">uint16_t params_len</div><div class="ttdef"><b>Definition:</b> <a href="er-http_8h_source.html#l00100">er-http.h:100</a></div></div>
<div class="ttc" id="er-http_8h_html"><div class="ttname"><a href="er-http_8h.html">er-http.h</a></div></div>
<div class="ttc" id="structcoap__request__params__t_html_ac262fa94e91da6023516bf068fcbd5c7"><div class="ttname"><a href="structcoap__request__params__t.html#ac262fa94e91da6023516bf068fcbd5c7">coap_request_params_t::action_len</a></div><div class="ttdeci">uint16_t action_len</div><div class="ttdef"><b>Definition:</b> <a href="er-http_8h_source.html#l00096">er-http.h:96</a></div></div>
<div class="ttc" id="struct__coap__client__request_html_a9fd8c98c9dea2d5880f4819d25ebd5f3"><div class="ttname"><a href="struct__coap__client__request.html#a9fd8c98c9dea2d5880f4819d25ebd5f3">_coap_client_request::http_conn</a></div><div class="ttdeci">void * http_conn</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8h_source.html#l00044">coap_client.h:44</a></div></div>
<div class="ttc" id="structhttpd__state_html_a3d38632fd170046da9c12d8656332a15"><div class="ttname"><a href="structhttpd__state.html#a3d38632fd170046da9c12d8656332a15">httpd_state::buffer</a></div><div class="ttdeci">char buffer[MAX_PAYLOAD_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="er-http_8h_source.html#l00133">er-http.h:133</a></div></div>
<div class="ttc" id="struct__coap__node__entry_html_ac178f0afc26790704d17ca2ea92fdcad"><div class="ttname"><a href="struct__coap__node__entry.html#ac178f0afc26790704d17ca2ea92fdcad">_coap_node_entry::node_data</a></div><div class="ttdeci">void * node_data</div><div class="ttdef"><b>Definition:</b> <a href="coap__node_8h_source.html#l00036">coap_node.h:36</a></div></div>
<div class="ttc" id="coap__node_8h_html"><div class="ttname"><a href="coap__node_8h.html">coap_node.h</a></div><div class="ttdoc">Contains the Coap Node definitions. </div></div>
<div class="ttc" id="group__HTTP_html_ga5277054d2661bd306a1f433fad5f52c6"><div class="ttname"><a href="group__HTTP.html#ga5277054d2661bd306a1f433fad5f52c6">ISO_amp</a></div><div class="ttdeci">#define ISO_amp</div><div class="ttdef"><b>Definition:</b> <a href="httpd_8h_source.html#l00058">httpd.h:58</a></div></div>
<div class="ttc" id="structhttpd__state_html_ac07fcecad21574af592e6ec01836cf45"><div class="ttname"><a href="structhttpd__state.html#ac07fcecad21574af592e6ec01836cf45">httpd_state::request_type</a></div><div class="ttdeci">short request_type</div><div class="ttdef"><b>Definition:</b> <a href="er-http_8h_source.html#l00129">er-http.h:129</a></div></div>
<div class="ttc" id="group__HTTP_html_ga0098566b2a9196c26cca3f296ee491a6"><div class="ttname"><a href="group__HTTP.html#ga0098566b2a9196c26cca3f296ee491a6">POST_PARAMS_VAL_MAX_LEN</a></div><div class="ttdeci">#define POST_PARAMS_VAL_MAX_LEN</div><div class="ttdef"><b>Definition:</b> <a href="httpd_8h_source.html#l00071">httpd.h:71</a></div></div>
<div class="ttc" id="struct__coap__client__request_html_ab7e9d17ee3d65a11fadd75d061ce1b9a"><div class="ttname"><a href="struct__coap__client__request.html#ab7e9d17ee3d65a11fadd75d061ce1b9a">_coap_client_request::owner</a></div><div class="ttdeci">void * owner</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8h_source.html#l00047">coap_client.h:47</a></div></div>
<div class="ttc" id="struct__coap__client__request_html_a11d86892e4742eaf25ae61e6948b702f"><div class="ttname"><a href="struct__coap__client__request.html#a11d86892e4742eaf25ae61e6948b702f">_coap_client_request::blen</a></div><div class="ttdeci">uint16_t blen</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8h_source.html#l00043">coap_client.h:43</a></div></div>
<div class="ttc" id="group__CoAP__Client_html_gaa6812ba14a17a404e0649f5bbce3242b"><div class="ttname"><a href="group__CoAP__Client.html#gaa6812ba14a17a404e0649f5bbce3242b">coap_client_event_new_request</a></div><div class="ttdeci">process_event_t coap_client_event_new_request</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8c_source.html#l00040">coap_client.c:40</a></div></div>
<div class="ttc" id="group__HTTP_html_gac71a488f29b32c1d43eb6cf6eab9544a"><div class="ttname"><a href="group__HTTP.html#gac71a488f29b32c1d43eb6cf6eab9544a">ISO_semi_colon</a></div><div class="ttdeci">#define ISO_semi_colon</div><div class="ttdef"><b>Definition:</b> <a href="httpd_8h_source.html#l00059">httpd.h:59</a></div></div>
<div class="ttc" id="struct__coap__client__request_html"><div class="ttname"><a href="struct__coap__client__request.html">_coap_client_request</a></div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8h_source.html#l00037">coap_client.h:37</a></div></div>
<div class="ttc" id="coap__client_8c_html_a0bfa1dc3bdf242a79626b4f855e17615"><div class="ttname"><a href="coap__client_8c.html#a0bfa1dc3bdf242a79626b4f855e17615">PROCESS_THREAD</a></div><div class="ttdeci">PROCESS_THREAD(coap_client_process, ev, data)</div><div class="ttdoc">Main Thread of CoAP Client. </div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8c_source.html#l00190">coap_client.c:190</a></div></div>
<div class="ttc" id="error__codes_8h_html"><div class="ttname"><a href="error__codes_8h.html">error_codes.h</a></div><div class="ttdoc">Contains the definition of all error used for the API REST and expose it. </div></div>
<div class="ttc" id="structcoap__request__params__t_html_a0b5de1f23728fbc139c7a5ee997bda32"><div class="ttname"><a href="structcoap__request__params__t.html#a0b5de1f23728fbc139c7a5ee997bda32">coap_request_params_t::action</a></div><div class="ttdeci">char * action</div><div class="ttdef"><b>Definition:</b> <a href="er-http_8h_source.html#l00094">er-http.h:94</a></div></div>
<div class="ttc" id="struct__coap__node__entry_html"><div class="ttname"><a href="struct__coap__node__entry.html">_coap_node_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="coap__node_8h_source.html#l00030">coap_node.h:30</a></div></div>
<div class="ttc" id="group__HTTP_html_ga008073805743aea3964e9a2502109aa1"><div class="ttname"><a href="group__HTTP.html#ga008073805743aea3964e9a2502109aa1">REQUEST_TYPE_POST</a></div><div class="ttdeci">#define REQUEST_TYPE_POST</div><div class="ttdef"><b>Definition:</b> <a href="er-http_8h_source.html#l00047">er-http.h:47</a></div></div>
<div class="ttc" id="httpd_8h_html"><div class="ttname"><a href="httpd_8h.html">httpd.h</a></div></div>
<div class="ttc" id="coap__client_8c_html_a4c8a1aeb0a1801312b52ea2cdfb6cf9a"><div class="ttname"><a href="coap__client_8c.html#a4c8a1aeb0a1801312b52ea2cdfb6cf9a">PROCESS</a></div><div class="ttdeci">PROCESS(coap_client_process, &quot;CoAP Client&quot;)</div></div>
<div class="ttc" id="struct__coap__client__request_html_a72c43dde31cefd70083b9bc0a1ed7c07"><div class="ttname"><a href="struct__coap__client__request.html#a72c43dde31cefd70083b9bc0a1ed7c07">_coap_client_request::uri</a></div><div class="ttdeci">char uri[POST_PARAMS_VAL_MAX_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8h_source.html#l00039">coap_client.h:39</a></div></div>
<div class="ttc" id="structhttpd__state_html_a93ff231e84af820b17c22f5bcede2150"><div class="ttname"><a href="structhttpd__state.html#a93ff231e84af820b17c22f5bcede2150">httpd_state::content_length</a></div><div class="ttdeci">int content_length</div><div class="ttdef"><b>Definition:</b> <a href="er-http_8h_source.html#l00111">er-http.h:111</a></div></div>
<div class="ttc" id="struct__coap__node__entry_html_aa20aa666bcdd70663a273b214dcf691a"><div class="ttname"><a href="struct__coap__node__entry.html#aa20aa666bcdd70663a273b214dcf691a">_coap_node_entry::requests</a></div><div class="ttdeci">uint8_t requests</div><div class="ttdef"><b>Definition:</b> <a href="coap__node_8h_source.html#l00035">coap_node.h:35</a></div></div>
<div class="ttc" id="group__CoAP__Client_html_ga89becbec245835d678855d3571224532"><div class="ttname"><a href="group__CoAP__Client.html#ga89becbec245835d678855d3571224532">coap_client_current_req_number</a></div><div class="ttdeci">int coap_client_current_req_number</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8c_source.html#l00038">coap_client.c:38</a></div></div>
<div class="ttc" id="struct__coap__client__request_html_a6f31e733fa039df89fe3139b4683af1e"><div class="ttname"><a href="struct__coap__client__request.html#a6f31e733fa039df89fe3139b4683af1e">_coap_client_request::content_type</a></div><div class="ttdeci">unsigned int content_type</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8h_source.html#l00046">coap_client.h:46</a></div></div>
<div class="ttc" id="coap__client_8c_html_a229ddaf533d2f729a841a99d80834546"><div class="ttname"><a href="coap__client_8c.html#a229ddaf533d2f729a841a99d80834546">client_chunk_handler</a></div><div class="ttdeci">void client_chunk_handler(void *response)</div><div class="ttdoc">Handles chunks transfer. </div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8c_source.html#l00162">coap_client.c:162</a></div></div>
<div class="ttc" id="struct__coap__client__request_html_ad0a7a8b7c5802f324f0906a3fc8ab878"><div class="ttname"><a href="struct__coap__client__request.html#ad0a7a8b7c5802f324f0906a3fc8ab878">_coap_client_request::resp_status</a></div><div class="ttdeci">unsigned int resp_status</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8h_source.html#l00045">coap_client.h:45</a></div></div>
<div class="ttc" id="struct__coap__client__request_html_a3af446f5833143823da2e317e5e1ad4e"><div class="ttname"><a href="struct__coap__client__request.html#a3af446f5833143823da2e317e5e1ad4e">_coap_client_request::params</a></div><div class="ttdeci">char params[POST_PARAMS_VAL_MAX_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8h_source.html#l00040">coap_client.h:40</a></div></div>
<div class="ttc" id="coap__client_8h_html"><div class="ttname"><a href="coap__client_8h.html">coap_client.h</a></div><div class="ttdoc">Contains the Definitions of the Coap Client. </div></div>
<div class="ttc" id="group__cc26xx-web-demo_html_gac045fe0b35ad45736402b693b70e62bd"><div class="ttname"><a href="group__cc26xx-web-demo.html#gac045fe0b35ad45736402b693b70e62bd">coap_client_event_new_response</a></div><div class="ttdeci">process_event_t coap_client_event_new_response</div><div class="ttdef"><b>Definition:</b> <a href="httpd_8c_source.html#l00109">httpd.c:109</a></div></div>
<div class="ttc" id="structhttpd__state_html"><div class="ttname"><a href="structhttpd__state.html">httpd_state</a></div><div class="ttdef"><b>Definition:</b> <a href="er-http_8h_source.html#l00104">er-http.h:104</a></div></div>
<div class="ttc" id="struct__coap__client__request_html_a7c9bdf048a6f3f99f120227bb6542eae"><div class="ttname"><a href="struct__coap__client__request.html#a7c9bdf048a6f3f99f120227bb6542eae">_coap_client_request::buffer</a></div><div class="ttdeci">char buffer[MAX_PAYLOAD_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8h_source.html#l00042">coap_client.h:42</a></div></div>
<div class="ttc" id="group__Debug_html_ga1f464e950a4fa11e8821b5c725921a15"><div class="ttname"><a href="group__Debug.html#ga1f464e950a4fa11e8821b5c725921a15">PRINTF</a></div><div class="ttdeci">#define PRINTF(...)</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8c_source.html#l00023">coap_client.c:23</a></div></div>
<div class="ttc" id="structcoap__request__params__t_html_a3ff7e4795a66b68be9e1dcc6e404a643"><div class="ttname"><a href="structcoap__request__params__t.html#a3ff7e4795a66b68be9e1dcc6e404a643">coap_request_params_t::params</a></div><div class="ttdeci">char * params</div><div class="ttdef"><b>Definition:</b> <a href="er-http_8h_source.html#l00098">er-http.h:98</a></div></div>
<div class="ttc" id="struct__coap__client__request_html_a0bf599ccdebfc7a8afadea03b9ff361c"><div class="ttname"><a href="struct__coap__client__request.html#a0bf599ccdebfc7a8afadea03b9ff361c">_coap_client_request::method</a></div><div class="ttdeci">uint8_t method</div><div class="ttdef"><b>Definition:</b> <a href="coap__client_8h_source.html#l00041">coap_client.h:41</a></div></div>
<div class="ttc" id="structhttpd__state_html_a50800bbad71d7f97217d783bde34249c"><div class="ttname"><a href="structhttpd__state.html#a50800bbad71d7f97217d783bde34249c">httpd_state::coap_req</a></div><div class="ttdeci">coap_request_params coap_req</div><div class="ttdef"><b>Definition:</b> <a href="er-http_8h_source.html#l00135">er-http.h:135</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Jun 10 2017 21:50:25 for Controller by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
